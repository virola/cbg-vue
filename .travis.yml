language: node_js
node_js:
  - "12"

install:
  - npm install

addons:
  ssh_known_hosts: 23.106.137.248:28787
script:
- npm run build && rsync -az -vv -e 'ssh -p 28787 -o stricthostkeychecking=no' dist/
  root@23.106.137.248:/home/wwwroot/default/h5/
before_install:
- openssl aes-256-cbc -K $encrypted_31d56be8cb94_key -iv $encrypted_31d56be8cb94_iv
  -in travis.enc -out travis -d
- chmod 600 travis
- mv travis ~/.ssh/id_rsa
- echo -e "Host 23.106.137.248\n\tStrictHostKeyChecking no\n" >> ~/.ssh/config

after_success:
  - cd ./dist
  - git init
  - git config --global user.name "${U_NAME}"
  - git config --global user.email "${U_EMAIL}"
  - git add .
  - git commit -m "Automatically update from travis-ci"
  - git push --quiet --force  "https://${GH_TOKEN}@${GH_REF}" master:${P_BRANCH}

branches:
  only:
    - main
